<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resultados da Pesquisa</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>Resultados da Pesquisa</h1>
    <p>Veja abaixo o resumo das respostas de todos os participantes.</p>
  </header>

  <main class="container">
    <h2>Visão Geral</h2>
    <canvas id="graficoGeral"></canvas>
    <div id="textoResumo" style="margin-top:20px; text-align:center;"></div>

    <h2 style="margin-top:40px;">Detalhamento por Pergunta</h2>
    <div class="graficos-individuais">
      <canvas id="p1Chart"></canvas>
      <canvas id="p2Chart"></canvas>
      <canvas id="p3Chart"></canvas>
      <canvas id="p4Chart"></canvas>
      <canvas id="p5Chart"></canvas>
      <canvas id="p6Chart"></canvas>
    </div>
  </main>

  <footer>
    <a href="index.html">Responder novamente</a>
  </footer>

  <script>
    const respostas = JSON.parse(localStorage.getItem("respostas")) || [];
    if (respostas.length === 0) {
      document.getElementById("textoResumo").innerText = "Nenhuma resposta enviada ainda.";
    } else {
      const opcoes = ["Muito Insatisfeito", "Insatisfeito", "Neutro", "Satisfeito", "Muito Satisfeito"];
      const contagem = Array(6).fill(0).map(() => [0,0,0,0,0]);

      respostas.forEach(r => {
        for (let i=1; i<=6; i++){
          const idx = opcoes.indexOf(r[`p${i}`]);
          if (idx >= 0) contagem[i-1][idx]++;
        }
      });

      const medias = contagem.map(p => {
        const total = p.reduce((a,b)=>a+b,0);
        const peso = p.reduce((a,b,i)=>a+b*(i+1),0);
        return total ? (peso / (total*5))*100 : 0;
      });

      const mediaGeral = Math.round(medias.reduce((a,b)=>a+b,0)/6);
      document.getElementById("textoResumo").innerText =
        `${mediaGeral}% das pessoas estão satisfeitas com o serviço.`;

      new Chart(document.getElementById("graficoGeral"), {
        type: 'bar',
        data: {
          labels: ['Pergunta 1','Pergunta 2','Pergunta 3','Pergunta 4','Pergunta 5','Pergunta 6'],
          datasets: [{
            label: '% de Satisfação Média',
            data: medias,
            backgroundColor: 'rgba(46, 204, 113, 0.7)',
            borderColor: 'rgba(39, 174, 96, 1)',
            borderWidth: 2
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true, max: 100, title: { display: true, text: '% Satisfação' } }
          }
        }
      });

      contagem.forEach((p, i) => {
        new Chart(document.getElementById(`p${i+1}Chart`), {
          type: 'bar',
          data: {
            labels: opcoes,
            datasets: [{
              label: `Pergunta ${i+1}`,
              data: p,
              backgroundColor: [
                'rgba(231, 76, 60, 0.7)',
                'rgba(241, 148, 138, 0.7)',
                'rgba(241, 196, 15, 0.7)',
                'rgba(88, 214, 141, 0.7)',
                'rgba(46, 204, 113, 0.7)'
              ],
              borderWidth: 2
            }]
          },
          options: {
            plugins: {
              legend: { display: false },
              title: { display: true, text: `Pergunta ${i+1}` }
            },
            scales: {
              y: { beginAtZero: true, title: { display: true, text: 'Número de respostas' } }
            }
          }
        });
      });
    }
  </script>
</body>
</html>
